<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Test</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }
    </style>
</head>

<body>
    <h1>Filter Servers</h1>
    <form id="filterForm">
        <label for="filter">Enter Filter:</label>
        <input style="min-width: 1000px;" type="text" id="filter" name="filter"
            value="cluster(airfield, water_treatment, north, 1000)" required>
        <br><button type="submit">Go</button>
    </form>
    <div id="results"></div>
    <table id="serverTable" style="display: none;">
        <thead>
            <tr>
                <th>Server Name</th>
                <th>IP</th>
                <th>Player Count</th>
                <th>Rustmaps URL</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        document.getElementById('filterForm').addEventListener('submit', async (event) => {
            event.preventDefault();

            const filterString = document.getElementById('filter').value;
            const resultsDiv = document.getElementById('results');
            const serverTable = document.getElementById('serverTable');
            const tbody = serverTable.querySelector('tbody');
            resultsDiv.textContent = 'Loading...';
            serverTable.style.display = 'none';
            tbody.innerHTML = '';

            try {
                const response = await fetch(`https://4327-117-20-68-163.ngrok-free.app/api/filter?filter=${encodeURIComponent(filterString)}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': '69420'
                    }
                });

                const data = await response.json();

                if (!data.error) {
                    resultsDiv.textContent = '';
                    serverTable.style.display = '';
                    data.data.forEach(server => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${server.name}</td>
                            <td>${server.ip}</td>
                            <td>${server.playerCount}</td>
                            <td><a href="${server.map.url}" target="_blank">${server.map.url}</a></td>
                        `;
                        tbody.appendChild(row);
                    });
                } else {
                    resultsDiv.textContent = 'Error: ' + data.message;
                }
            } catch (error) {
                resultsDiv.textContent = 'Request failed: ' + error.message;
            }
        });
    </script>
</body>

</html>